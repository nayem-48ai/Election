name: Super Extract and Force Update

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write
  actions: write

jobs:
  unzip-and-force-push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # পুরো হিস্টোরি নেওয়ার জন্য

      - name: Extract and Overwrite
        run: |
          ZIP_FILE=$(ls *.zip 2>/dev/null | head -n 1)
          if [ -n "$ZIP_FILE" ]; then
            unzip -o "$ZIP_FILE" -d ./temp_folder
            # শুধু .github ফোল্ডারটি ম্যানুয়ালি কপি করা
            cp -r ./temp_folder/.github/workflows/* .github/workflows/ 2>/dev/null || true
            # বাকি ফাইলগুলো কপি করা
            cp -r ./temp_folder/* . 2>/dev/null || true
            rm -rf ./temp_folder
            rm "$ZIP_FILE"
          fi

      - name: Commit and Push with GITHUB_TOKEN
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          git add .
          git commit -m "chore: force update workflows from zip" || exit 0
          
          # সরাসরি পুশ কাজ না করলে নিচের রিমোট সেটআপটি কাজ করবে
          git remote set-url origin https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}.git
          git push origin main
